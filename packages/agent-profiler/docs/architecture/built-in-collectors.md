# Built-in Collectors

Reference for the 4 built-in Collector implementations that ship with `@ghx-dev/agent-profiler`.

Each collector implements the `Collector` interface and extracts quantitative metrics from `PromptResult` and optional `SessionTrace` data. Collectors run after every `prompt()` call and write their metrics into `ProfileRow.extensions`.

```typescript
import { TokenCollector, LatencyCollector, CostCollector, ToolCallCollector } from "@ghx-dev/agent-profiler"
```

## TokenCollector

Extracts token usage counts from the `PromptResult.metrics.tokens` field.

- **Class:** `TokenCollector`
- **id:** `"token"`
- **Source:** `packages/agent-profiler/src/collector/token-collector.ts`

### Metrics

| Metric Name | Unit | Description |
|-------------|------|-------------|
| `tokens_input` | tokens | Input tokens consumed by the prompt |
| `tokens_output` | tokens | Output tokens generated by the model |
| `tokens_reasoning` | tokens | Tokens spent on internal reasoning (extended thinking) |
| `tokens_cache_read` | tokens | Tokens served from the provider cache |
| `tokens_cache_write` | tokens | Tokens written to the provider cache |
| `tokens_total` | tokens | Sum of all token categories |
| `tokens_active` | tokens | Non-cached tokens (total minus cache reads) |

## LatencyCollector

Extracts wall-clock latency and per-segment timing from the `PromptResult.metrics.timing` field.

- **Class:** `LatencyCollector`
- **id:** `"latency"`
- **Source:** `packages/agent-profiler/src/collector/latency-collector.ts`

### Metrics

| Metric Name | Unit | Description |
|-------------|------|-------------|
| `latency_wall_ms` | ms | Total wall-clock time from prompt submission to response completion |
| `latency_<label>_ms` | ms | Per-segment latency for each timing label in `PromptResult.metrics.timing.segments` |

The segment metrics are dynamic. For example, if the provider reports segments `["reasoning", "generation"]`, the collector emits `latency_reasoning_ms` and `latency_generation_ms`.

## CostCollector

Reads pre-computed cost values from the `PromptResult.metrics.cost` field.

- **Class:** `CostCollector`
- **id:** `"cost"`
- **Source:** `packages/agent-profiler/src/collector/cost-collector.ts`

### Metrics

| Metric Name | Unit | Description |
|-------------|------|-------------|
| `cost_total_usd` | usd | Total estimated cost for the iteration |
| `cost_input_usd` | usd | Cost attributed to input tokens |
| `cost_output_usd` | usd | Cost attributed to output tokens |
| `cost_reasoning_usd` | usd | Cost attributed to reasoning tokens |

## ToolCallCollector

Counts and categorizes tool calls extracted from the `PromptResult.metrics.toolCalls` array.

- **Class:** `ToolCallCollector`
- **id:** `"tool_calls"`
- **Source:** `packages/agent-profiler/src/collector/tool-call-collector.ts`

### Metrics

| Metric Name | Unit | Description |
|-------------|------|-------------|
| `tool_calls_total` | count | Total number of tool calls in the response |
| `tool_calls_failed` | count | Tool calls that returned an error |
| `tool_calls_error_rate` | ratio | `failed / total` (0 when total is 0) |
| `tool_calls_unique` | count | Number of distinct tool names used |
| `tool_calls_category_<name>` | count | Count per tool category, one metric per category (alphabetically sorted) |

Category metrics are dynamic. If the response includes tool calls categorized as `"file_read"` and `"file_write"`, the collector emits `tool_calls_category_file_read` and `tool_calls_category_file_write`.

## Related Documentation

- [Plugin Contracts](./plugin-contracts.md)
- [Built-in Analyzers](./built-in-analyzers.md)
- [System Overview](./overview.md)
- [Statistics Engine](./statistics.md)
